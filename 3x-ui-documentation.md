# Полная документация веб-панели 3x-ui v2.6.0

## Оглавление
- [Введение](#введение)
- [Основные возможности](#основные-возможности)
- [Системные требования](#системные-требования)
- [Установка](#установка)
- [Архитектура и компоненты](#архитектура-и-компоненты)
- [Поддерживаемые протоколы](#поддерживаемые-протоколы)
- [Транспортные протоколы](#транспортные-протоколы)
- [Методы шифрования и обфускации](#методы-шифрования-и-обфускации)
- [Управление пользователями](#управление-пользователями)
- [Telegram Bot](#telegram-bot)
- [WARP интеграция](#warp-интеграция)
- [Статистика и мониторинг](#статистика-и-мониторинг)
- [Безопасность](#безопасность)
- [API и автоматизация](#api-и-автоматизация)
- [Резервное копирование](#резервное-копирование)
- [Настройка клиентов](#настройка-клиентов)
- [Решение проблем](#решение-проблем)

## Введение

3x-ui - это мощная веб-панель управления для Xray-core, представляющая собой форк популярной панели x-ui с улучшенной стабильностью и расширенным функционалом. Панель предоставляет удобный графический интерфейс для настройки и управления VPN-соединениями на базе различных протоколов.

### Ключевые особенности
- Поддержка множества протоколов (VLESS, VMess, Trojan, Shadowsocks, WireGuard)
- Современные методы обфускации (REALITY, XTLS Vision)
- Многопользовательская система с ограничениями трафика
- Встроенный Telegram-бот для управления
- Автоматическое обновление SSL-сертификатов
- Детальная статистика использования
- Поддержка Docker и традиционной установки

## Основные возможности

### Функциональные возможности
1. **Мультипротокольность**
   - Поддержка всех современных VPN-протоколов
   - Возможность создания множественных входящих соединений
   - Гибкая настройка каждого протокола

2. **Управление пользователями**
   - Создание неограниченного количества пользователей
   - Установка лимитов трафика для каждого пользователя
   - Ограничение по времени действия аккаунта
   - Ограничение по количеству одновременных подключений
   - Группировка пользователей (начиная с v2.5.0)

3. **Мониторинг и статистика**
   - Отслеживание трафика в реальном времени
   - История использования по каждому пользователю
   - Системная статистика (CPU, RAM, диск)
   - Логирование всех действий

4. **Безопасность**
   - Двухфакторная аутентификация (с v2.6.0)
   - Хеширование паролей
   - Поддержка SSL/TLS сертификатов
   - Fail2ban интеграция для защиты от брутфорса

## Системные требования

### Минимальные требования
- **ОС**: Ubuntu 16.04+, Debian 8+, CentOS 7+, Fedora 36+, Arch Linux
- **Архитектура**: x86_64, ARM64, ARMv7, s390x
- **RAM**: 128 MB (рекомендуется 512 MB+)
- **Диск**: 200 MB свободного места
- **CPU**: 1 ядро (рекомендуется 2+)

### Поддерживаемые платформы
- Обычные VPS/VDS серверы
- Docker контейнеры
- Virtuozzo контейнеры
- ARM устройства (Raspberry Pi и др.)

## Установка

### Быстрая установка (последняя версия)
```bash
bash <(curl -Ls https://raw.githubusercontent.com/mhsanaei/3x-ui/master/install.sh)
```

### Установка конкретной версии
```bash
VERSION=v2.6.0 && bash <(curl -Ls "https://raw.githubusercontent.com/mhsanaei/3x-ui/$VERSION/install.sh") $VERSION
```

### Docker установка
```bash
docker run -itd \
    -e XRAY_VMESS_AEAD_FORCED=false \
    -v $PWD/db/:/etc/x-ui/ \
    -v $PWD/cert/:/root/cert/ \
    --network=host \
    --restart=unless-stopped \
    --name 3x-ui \
    ghcr.io/mhsanaei/3x-ui:latest
```

### Docker Compose
```yaml
version: "3"
services:
  3x-ui:
    image: ghcr.io/mhsanaei/3x-ui:latest
    container_name: 3x-ui
    hostname: yourdomain.com
    volumes:
      - $PWD/db/:/etc/x-ui/
      - /etc/letsencrypt/:/etc/letsencrypt/:rw
    environment:
      XRAY_VMESS_AEAD_FORCED: "false"
    tty: true
    network_mode: host
    restart: unless-stopped
```

### Первоначальная настройка
После установки:
1. Доступ к панели: `http://IP:2053`
2. Логин по умолчанию: `admin`
3. Пароль по умолчанию: `admin`

⚠️ **Важно**: Сразу после первого входа измените логин и пароль!

## Архитектура и компоненты

### Основные компоненты
1. **Xray-core** - ядро для обработки VPN-трафика
2. **Web UI** - веб-интерфейс на Vue.js
3. **Backend** - сервер на Go
4. **SQLite** - база данных для хранения конфигураций
5. **Telegram Bot** - модуль для удаленного управления

### Структура проекта
```
3x-ui/
├── web/          # Веб-интерфейс
├── database/     # Модели и миграции БД
├── service/      # Бизнес-логика
├── util/         # Утилиты
├── xray/         # Интеграция с Xray-core
└── tgbot/        # Telegram бот
```

## Поддерживаемые протоколы

### 1. VLESS (рекомендуется)
**Описание**: Легковесный протокол без состояния, разработанный проектом XTLS. Не полагается на системное время и использует UUID для аутентификации.

**Особенности**:
- Отсутствие встроенного шифрования (требует TLS/REALITY)
- Поддержка XTLS Vision для максимальной производительности
- Совместимость с REALITY для маскировки
- Минимальные накладные расходы

**Настройки**:
- **UUID**: Уникальный идентификатор пользователя
- **Flow**: xtls-rprx-vision (для XTLS)
- **Encryption**: none (шифрование обеспечивается транспортом)
- **Level**: Уровень пользователя (0-255)

### 2. VMess
**Описание**: Проприетарный протокол V2Ray, использующий шифрование и обфускацию для сокрытия трафика.

**Особенности**:
- Встроенное шифрование (AES-128-GCM)
- Поддержка изменения ID для защиты от повторных атак
- Совместимость с различными транспортами
- Требует синхронизации времени

**Настройки**:
- **UUID**: Идентификатор пользователя
- **AlterID**: Дополнительные ID (устарело, рекомендуется 0)
- **Security**: auto/aes-128-gcm/chacha20-poly1305/none

### 3. Trojan
**Описание**: Протокол, имитирующий HTTPS-трафик для обхода DPI.

**Особенности**:
- Использует стандартный порт 443
- Трафик неотличим от обычного HTTPS
- Требует действительный SSL-сертификат
- Простая конфигурация

**Настройки**:
- **Password**: Пароль для аутентификации
- **Email**: Идентификатор пользователя
- **Level**: Уровень доступа

### 4. Shadowsocks
**Описание**: Легковесный прокси-протокол с шифрованием.

**Особенности**:
- Высокая скорость работы
- Простота настройки
- Поддержка различных методов шифрования
- Оптимизирован для мобильных устройств

**Методы шифрования**:
- 2022-blake3-aes-128-gcm
- 2022-blake3-aes-256-gcm
- 2022-blake3-chacha20-poly1305
- aes-256-gcm
- aes-128-gcm
- chacha20-poly1305

### 5. WireGuard
**Описание**: Современный VPN-протокол на уровне ядра.

**Особенности**:
- Минимальная задержка
- Высокая производительность
- Простая криптография
- Работает на уровне ядра ОС

**Настройки**:
- **Private/Public Key**: Пара ключей
- **Address**: IP-адрес в туннеле
- **DNS**: DNS-серверы
- **MTU**: Размер пакета

### 6. Dokodemo-door
**Описание**: Протокол для перенаправления трафика.

**Особенности**:
- Перехват и перенаправление любого трафика
- Полезен для создания сложных схем маршрутизации
- Поддержка TCP и UDP

### 7. SOCKS
**Описание**: Универсальный прокси-протокол.

**Версии**:
- SOCKS4/4a
- SOCKS5 (с аутентификацией)

### 8. HTTP
**Описание**: Простой HTTP-прокси.

**Особенности**:
- Работает только с HTTP/HTTPS трафиком
- Поддержка аутентификации
- Простая настройка

## Транспортные протоколы

### 1. TCP (RAW)
**Описание**: Базовый TCP-транспорт без дополнительной обфускации.

**Особенности**:
- Максимальная производительность
- Минимальные накладные расходы
- Легко обнаруживается DPI

**Настройки**:
- **acceptProxyProtocol**: Поддержка PROXY protocol
- **Header**: Настройки заголовков (none/http)

### 2. WebSocket
**Описание**: Транспорт через WebSocket соединение.

**Особенности**:
- Проходит через большинство прокси
- Совместим с CDN (Cloudflare)
- Маскируется под обычный веб-трафик

**Настройки**:
- **Path**: Путь WebSocket
- **Headers**: Дополнительные заголовки
- **Max Early Data**: Размер ранних данных
- **Browser Forwarding**: Перенаправление браузера

### 3. HTTP/2
**Описание**: Транспорт через HTTP/2 протокол.

**Особенности**:
- Мультиплексирование потоков
- Сжатие заголовков
- Хорошая производительность

**Настройки**:
- **Host**: Список хостов
- **Path**: Путь запроса
- **Read Idle Timeout**: Таймаут простоя

### 4. gRPC
**Описание**: Транспорт на базе gRPC.

**Особенности**:
- Высокая производительность
- Поддержка HTTP/2
- Работает через CDN

**Настройки**:
- **Service Name**: Имя сервиса
- **Authority**: Заголовок authority
- **Multi Mode**: Режим мультиплексирования

### 5. QUIC
**Описание**: Транспорт на базе UDP с мультиплексированием.

**Особенности**:
- На базе UDP (не TCP)
- Встроенное шифрование
- Низкая задержка
- Устойчивость к потерям пакетов

**Настройки**:
- **Security**: none/aes-128-gcm/chacha20-poly1305
- **Key**: Ключ шифрования
- **Header Type**: none/srtp/utp/wechat-video/dtls/wireguard

### 6. mKCP
**Описание**: Модифицированный KCP протокол на базе UDP.

**Особенности**:
- Оптимизирован для нестабильных соединений
- Настраиваемые параметры передачи
- Различные типы обфускации

**Настройки**:
- **MTU**: Максимальный размер пакета
- **TTI**: Интервал передачи (10-100 мс)
- **Uplink/Downlink Capacity**: Пропускная способность
- **Read/Write Buffer**: Размер буферов
- **Seed**: Ключ обфускации
- **Header Type**: none/srtp/utp/wechat-video/dtls/wireguard

### 7. HTTPUpgrade
**Описание**: Транспорт через HTTP Upgrade.

**Особенности**:
- Совместимость с прокси
- Маскировка под WebSocket
- Простая настройка

**Настройки**:
- **Path**: Путь обновления
- **Host**: Хост сервера
- **Headers**: Дополнительные заголовки

### 8. XHTTP
**Описание**: Расширенный HTTP транспорт.

**Особенности**:
- Улучшенная производительность
- Поддержка больших данных
- Оптимизация для стриминга

**Настройки**:
- **scMaxConcurrentPosts**: Макс. параллельных запросов
- **scMaxEachPostBytes**: Макс. размер POST
- **scMinPostsIntervalMs**: Интервал между POST

## Методы шифрования и обфускации

### REALITY
**Описание**: Революционная технология маскировки VPN-трафика под обычный TLS.

**Принцип работы**:
- Использует SNI реального сайта для маскировки
- Устраняет TLS fingerprint сервера
- Обеспечивает perfect forward secrecy
- Предотвращает атаки на цепочку сертификатов

**Настройки**:
- **Dest**: Целевой сайт (например, dl.google.com:443)
- **SNI**: Server Name Indication
- **Private Key**: Приватный ключ (генерируется ./xray x25519)
- **Short IDs**: Короткие идентификаторы клиентов
- **Spider X**: Параметры веб-краулера

**Рекомендуемые сайты для маскировки**:
- dl.google.com
- www.microsoft.com
- www.apple.com
- www.amazon.com
- www.cloudflare.com

### XTLS Vision
**Описание**: Технология устранения характеристик TLS-in-TLS.

**Особенности**:
- Автоматическое включение Splice для оптимизации
- Устранение двойного шифрования
- Максимальная производительность
- Совместимость с REALITY

**Требования**:
- Протокол: VLESS
- Транспорт: TCP/mKCP
- Flow: xtls-rprx-vision

### uTLS Fingerprinting
**Описание**: Имитация TLS отпечатков популярных браузеров.

**Доступные отпечатки**:
- chrome
- firefox
- safari
- ios
- android
- edge
- 360
- qq
- random
- randomized

### TLS настройки
**Параметры**:
- **Server Name**: Имя сервера
- **ALPN**: Протоколы прикладного уровня
- **Certificates**: SSL сертификаты
- **Cipher Suites**: Наборы шифров
- **Min/Max Version**: Версии TLS (1.2-1.3)
- **Pinned Peer Certificate**: Закрепление сертификата

## Управление пользователями

### Создание пользователей
1. **Email**: Уникальный идентификатор
2. **UUID/Password**: Credentials для подключения
3. **Enable**: Включение/отключение пользователя
4. **Flow**: Тип потока (для VLESS)
5. **Limit IP**: Ограничение одновременных подключений
6. **Total Flow**: Лимит трафика (GB)
7. **Expire Date**: Дата истечения
8. **Telegram ID**: ID для уведомлений
9. **Reset Period**: Период сброса трафика

### Группы пользователей (v2.5.0+)
**Функции**:
- Объединение пользователей в группы
- Общие настройки для группы
- Массовое управление
- Отдельная статистика по группам

### Ограничения
1. **По трафику**:
   - Общий лимит
   - Ежемесячный сброс
   - Ежедневный лимит

2. **По времени**:
   - Дата истечения
   - Временные интервалы доступа

3. **По IP**:
   - Количество одновременных подключений
   - Белый список IP
   - Fail2ban интеграция

## Telegram Bot

### Возможности
1. **Уведомления**:
   - Ежедневная статистика
   - Вход в панель
   - Достижение лимитов
   - Истечение аккаунтов
   - Системные события

2. **Управление**:
   - Просмотр статистики
   - Управление пользователями
   - Резервное копирование БД
   - Перезапуск сервисов
   - Получение конфигураций

3. **Команды бота**:
   - `/start` - Начало работы
   - `/status` - Статус системы
   - `/stats` - Статистика
   - `/users` - Список пользователей
   - `/backup` - Создать резервную копию
   - `/restart` - Перезапустить Xray
   - `/help` - Помощь

### Настройка бота
1. Создать бота через @BotFather
2. Получить токен бота
3. Узнать свой Telegram ID через @userinfobot
4. Ввести данные в настройках панели

### Новые функции (v2.6.0)
- Кнопка "Все клиенты"
- Управление клиентами администраторами
- Расширенные уведомления

## WARP интеграция

### Описание
Cloudflare WARP обеспечивает дополнительный уровень защиты и маршрутизации.

### Установка
```bash
bash <(curl -sSL https://raw.githubusercontent.com/hamid-gh98/x-ui-scripts/main/install_warp_proxy.sh)
```

### Преимущества
- Дополнительное шифрование
- Обход региональных блокировок
- Защита от утечек DNS
- Улучшенная анонимность

### Конфигурация
```json
{
  "outbounds": [{
    "protocol": "socks",
    "settings": {
      "servers": [{
        "address": "127.0.0.1",
        "port": 40000
      }]
    },
    "tag": "warp"
  }]
}
```

## Статистика и мониторинг

### Системная статистика
1. **Ресурсы сервера**:
   - CPU использование
   - RAM использование
   - Диск (свободное место)
   - Сеть (входящий/исходящий трафик)
   - Uptime системы

2. **Xray статистика**:
   - Версия Xray
   - Статус службы
   - Количество подключений
   - Общий трафик

### Пользовательская статистика
1. **Трафик**:
   - Входящий/исходящий
   - По протоколам
   - По времени
   - По пользователям

2. **Подключения**:
   - Активные сессии
   - История подключений
   - IP-адреса клиентов
   - Используемые протоколы

### Логирование
1. **Уровни логов**:
   - none: Без логов
   - error: Только ошибки
   - warning: Предупреждения и ошибки
   - info: Информационные сообщения
   - debug: Подробная отладка

2. **Типы логов**:
   - access.log: Логи доступа
   - error.log: Логи ошибок
   - dns.log: DNS запросы

## Безопасность

### Двухфакторная аутентификация (2FA)
**Новое в v2.6.0**:
- QR-код для настройки
- Поддержка Google Authenticator
- Резервные коды

### Хеширование паролей
**Новое в v2.6.0**:
- Bcrypt хеширование
- Невозможность даунгрейда без сброса пароля

### SSL/TLS сертификаты

#### Автоматическое получение
1. **Let's Encrypt**:
```bash
x-ui
# Выбрать "SSL Certificate Management"
# Выбрать "Get SSL"
```

2. **Cloudflare SSL**:
- Требуется API ключ
- Автоматическое обновление
- Поддержка wildcard сертификатов

#### Ручная установка
```bash
apt-get install certbot -y
certbot certonly --standalone --agree-tos --register-unsafely-without-email -d yourdomain.com
certbot renew --dry-run
```

### Fail2ban интеграция
**Защита от брутфорса**:
1. Установка через панель управления
2. Автоматическая блокировка IP
3. Настройка правил блокировки
4. Логирование попыток

### Настройки безопасности
1. **Изменение порта панели**
2. **Случайный путь к панели**
3. **Ограничение доступа по IP**
4. **Отключение root доступа**
5. **Регулярные обновления**

## API и автоматизация

### RESTful API
**Эндпоинты**:
- `/login` - Аутентификация
- `/panel/api/inbounds` - Управление входящими соединениями
- `/panel/api/clients` - Управление клиентами
- `/panel/api/stats` - Статистика

### Автоматизация задач
1. **Резервное копирование**:
   - Автоматическое по расписанию
   - Загрузка в облако
   - Ротация бэкапов

2. **Мониторинг**:
   - Проверка доступности
   - Алерты при проблемах
   - Автоперезапуск сервисов

3. **Обновления**:
   - Автоматическая проверка
   - Безопасное обновление
   - Откат при ошибках

## Резервное копирование

### Встроенное резервное копирование
1. **Через веб-интерфейс**:
   - Настройки → Резервное копирование
   - Скачать/Загрузить базу данных

2. **Через Telegram бота**:
   - Команда `/backup`
   - Автоматическая отправка файла

### Ручное резервное копирование
```bash
# База данных
cp /etc/x-ui/x-ui.db /backup/x-ui.db.$(date +%Y%m%d)

# Полное резервное копирование
tar -czf 3x-ui-backup.tar.gz /etc/x-ui/ /usr/local/x-ui/
```

### Восстановление
1. Остановить сервис: `systemctl stop x-ui`
2. Восстановить файлы
3. Запустить сервис: `systemctl start x-ui`

## Настройка клиентов

### Поддерживаемые клиенты

#### Windows
- **v2rayN**: Полная поддержка всех протоколов
- **Qv2ray**: Расширенные возможности
- **WinXray**: Простой интерфейс

#### macOS
- **V2RayX**: Нативное приложение
- **Qv2ray**: Кроссплатформенный
- **ClashX**: Продвинутые правила

#### Android
- **v2rayNG**: Официальный клиент
- **Matsuri**: Расширенный функционал
- **SagerNet**: Множество протоколов

#### iOS
- **Shadowrocket**: Платный, полнофункциональный
- **Quantumult X**: Продвинутые возможности
- **Surge**: Профессиональный инструмент

#### Linux
- **Qv2ray**: GUI клиент
- **v2ray-core**: Консольный
- **Xray-core**: Прямое использование

### Экспорт конфигураций
1. **QR-код**: Сканирование мобильными клиентами
2. **Ссылка**: vmess://, vless://, trojan://
3. **JSON**: Полная конфигурация
4. **Подписка**: Для массового импорта

### Настройка подписок
**Функции**:
- Автоматическое обновление конфигураций
- Кастомные заголовки подписок
- Фильтрация по группам
- Шифрование подписок

## Решение проблем

### Частые проблемы

#### 1. Панель недоступна
```bash
# Проверить статус
systemctl status x-ui

# Проверить логи
journalctl -u x-ui -f

# Перезапустить
systemctl restart x-ui
```

#### 2. Клиенты не подключаются
- Проверить время сервера
- Проверить открытые порты
- Проверить правильность конфигурации
- Просмотреть логи Xray

#### 3. Низкая скорость
- Оптимизировать настройки TCP
- Использовать BBR
- Выбрать оптимальный протокол
- Проверить лимиты пользователей

### Оптимизация производительности

#### TCP оптимизация
```bash
# /etc/sysctl.conf
net.core.default_qdisc=fq
net.ipv4.tcp_congestion_control=bbr
net.ipv4.tcp_fastopen=3
```

#### Xray оптимизация
```json
{
  "sockopt": {
    "tcpFastOpen": true,
    "tcpNoDelay": true,
    "tcpKeepAliveInterval": 30,
    "tcpMptcp": true,
    "tcpCongestion": "bbr"
  }
}
```

### Диагностика

#### Команды диагностики
```bash
# Проверка портов
ss -tlnp | grep <port>

# Проверка сертификатов
openssl s_client -connect domain.com:443

# Тест скорости
speedtest-cli

# Проверка DNS
nslookup domain.com
```

#### Логи для анализа
1. **Системные логи**: `/var/log/syslog`
2. **Xray логи**: Настройки → Xray → Логи
3. **Панель логи**: `journalctl -u x-ui`

## Обновления и миграция

### Обновление панели
```bash
# Автоматическое обновление
x-ui update

# Ручное обновление
bash <(curl -Ls https://raw.githubusercontent.com/mhsanaei/3x-ui/master/install.sh)
```

### Миграция данных
1. Создать резервную копию старой панели
2. Установить новую версию
3. Восстановить базу данных
4. Проверить работоспособность

### Важные изменения версий
- **v2.6.0**: 2FA, хеширование паролей
- **v2.5.0**: Группы пользователей
- **v2.4.0**: REALITY улучшения
- **v2.3.0**: XTLS Vision

## Дополнительные ресурсы

### Официальные ресурсы
- GitHub: https://github.com/MHSanaei/3x-ui
- Telegram канал разработчика: @Xray_Panel
- Документация Xray: https://xtls.github.io

### Сообщество
- Telegram группы поддержки
- GitHub Issues для багов
- Форумы и чаты пользователей

### Полезные инструменты
- UUID генератор: `xray uuid`
- X25519 генератор: `xray x25519`
- Проверка конфигурации: `xray -test`

---

*Документация актуальна для версии 3x-ui v2.6.0*
*Последнее обновление: Май 2025*